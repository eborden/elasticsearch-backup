#!/usr/bin/env node

'use strict';

var prom = require('../build/src/promiscuous-config.js'),
    command = process.argv.slice(2, 3)[0],
    argOptions = {
            'host': 'Host location of ElastSearch instance',
            'index': 'The index you want to target on ES',
            'type': 'The type you want to target on ES',
            'port': 'The port which to access ES, defaults to 9200',
            'filePath': 'Target directory for backup files',
            'version': 'Which ES backup to pull from, defaults to latest'
        },
    options = argsToOptions(process.argv.slice(3));

if (options.hasOwnProperty('help')) {
    console.log('esbackup <command>[pack|unpack] [--option value]\n');
    Object.keys(argOptions).forEach(function (option) {
        console.log('--' + option + ': ' + argOptions[option]);
    });
    return;
}

switch (command) {
    case 'pack':
        return require('../build/src/pack.js')(options);
    case 'unpack':
        return require('../build/src/unpack.js')(options);
    default:
        return console.log('WTF, where is your command?!');
}

function argsToOptions (args) {
    var horribleDelimiter = '?**?**?';
    return args.join(horribleDelimiter).split('--').reduce(function (options, arg) {
        if (arg) {
            var a = arg.split(horribleDelimiter);
            options[a[0]] = a[1];
        }
        return options;
    }, {});
}
